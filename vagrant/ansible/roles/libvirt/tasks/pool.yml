- name: create /data
  file:
    path: /data
    state: directory

- name: force ownership of /data to vagrant
  file:
    path: /data
    state: directory
    owner: vagrant
    group: vagrant

- name: define libvirt pool
  command: virsh -c qemu:///system pool-define-as default --type dir --target /data/vms
  
- name: build libvirt pool
  command: virsh -c qemu:///system pool-build default
  
- name: fix permissions on pool directory
  file:
    path: /data/vms
    state: directory
    owner: vagrant
    group: vagrant

- name: set libvirt pool as autostart
  command: virsh -c qemu:///system pool-autostart default

- name: ensure libvirt pool is started
  command: virsh -c qemu:///system pool-start default
  ignore_errors: yes